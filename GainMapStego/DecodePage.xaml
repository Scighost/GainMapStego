<?xml version="1.0" encoding="utf-8" ?>
<Page x:Class="GainMapStego.DecodePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:local="using:GainMapStego"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      x:DefaultBindMode="OneWay"
      mc:Ignorable="d">

    <Page.Resources>
        <local:ZoomFactorPercentConverter x:Key="ZoomFactorPercentConverter" />
    </Page.Resources>

    <Grid x:Name="RootGrid"
          AllowDrop="True"
          Background="Transparent"
          DragLeave="RootGrid_DragLeave"
          DragOver="RootGrid_DragOver"
          Drop="RootGrid_Drop">
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>


        <!--  打开新文件 / 图片列表  -->
        <Grid x:Name="Grid_ImageInfo"
              Grid.RowSpan="2"
              Grid.Column="0"
              Margin="0,44,0,0"
              RowSpacing="8">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
            </Grid.RowDefinitions>

            <Button Margin="12,0,12,0"
                    HorizontalAlignment="Stretch"
                    Command="{x:Bind OpenFileCommand}"
                    Content="打开新文件" />

            <!--  图片列表  -->
            <ListView x:Name="ListView_ImageInfos"
                      Grid.Row="1"
                      Padding="0,0,8,0"
                      ItemsSource="{x:Bind ImageInfos}"
                      SelectedItem="{x:Bind SelectedImageInfo, Mode=TwoWay}">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="local:ImageInfo">
                        <Grid x:Name="Grid_ImageInfosItem"
                              MaxHeight="140"
                              Margin="0,12,0,12"
                              Background="Transparent"
                              CornerRadius="4">
                            <Image Source="{x:Bind Thumbnail}" Stretch="Uniform" />
                            <!--  图片类型  -->
                            <Border HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Background="{ThemeResource ControlOnImageFillColorDefaultBrush}"
                                    CornerRadius="0,0,4,0">
                                <TextBlock Margin="4,2,4,2"
                                           HorizontalAlignment="Center"
                                           FontSize="12"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           Text="{x:Bind Title}" />
                            </Border>
                            <!--  保存菜单  -->
                            <Border HorizontalAlignment="Right"
                                    VerticalAlignment="Top"
                                    Background="{ThemeResource ControlOnImageFillColorDefaultBrush}"
                                    CornerRadius="0,0,0,4">
                                <Button Padding="0"
                                        CornerRadius="0"
                                        Style="{ThemeResource DateTimePickerFlyoutButtonStyle}">
                                    <FontIcon Margin="4,0,4,0"
                                              FontSize="16"
                                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                              Glyph="&#xE712;" />
                                    <Button.Flyout>
                                        <MenuFlyout Placement="RightEdgeAlignedTop">
                                            <MenuFlyoutItem x:Name="MenuFlyoutItem_Copy"
                                                            Click="MenuFlyoutItem_Copy_Click"
                                                            Tag="{x:Bind}"
                                                            Text="复制">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE8C8;" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                            <MenuFlyoutItem x:Name="MenuFlyoutItem_SaveAs"
                                                            Click="MenuFlyoutItem_SaveAs_Click"
                                                            Tag="{x:Bind}"
                                                            Text="另存为">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE74E;" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                        </MenuFlyout>
                                    </Button.Flyout>
                                </Button>
                            </Border>
                            <Grid.ContextFlyout>
                                <MenuFlyout Placement="RightEdgeAlignedTop">
                                    <MenuFlyoutItem Click="MenuFlyoutItem_Copy_Click"
                                                    Tag="{x:Bind}"
                                                    Text="复制">
                                        <MenuFlyoutItem.Icon>
                                            <FontIcon Glyph="&#xE8C8;" />
                                        </MenuFlyoutItem.Icon>
                                    </MenuFlyoutItem>
                                    <MenuFlyoutItem Click="MenuFlyoutItem_SaveAs_Click"
                                                    Tag="{x:Bind}"
                                                    Text="另存为">
                                        <MenuFlyoutItem.Icon>
                                            <FontIcon Glyph="&#xE74E;" />
                                        </MenuFlyoutItem.Icon>
                                    </MenuFlyoutItem>
                                </MenuFlyout>
                            </Grid.ContextFlyout>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>


        <!--  图片  -->
        <ScrollViewer x:Name="ScrollViewer_Image"
                      Grid.Column="1"
                      HorizontalContentAlignment="Center"
                      CornerRadius="4,0,0,0"
                      DoubleTapped="ScrollViewer_Image_DoubleTapped"
                      HorizontalScrollBarVisibility="Hidden"
                      HorizontalScrollMode="Enabled"
                      MaxZoomFactor="5"
                      PointerMoved="ScrollViewer_Image_PointerMoved"
                      PointerPressed="ScrollViewer_Image_PointerPressed"
                      PointerReleased="ScrollViewer_Image_PointerReleased"
                      PointerWheelChanged="ScrollViewer_Image_PointerWheelChanged"
                      VerticalScrollBarVisibility="Hidden"
                      VerticalScrollMode="Enabled"
                      ZoomMode="Enabled">
            <Image x:Name="DiaplayImage"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Source="{x:Bind SelectedImageInfo.Source}"
                   Stretch="Uniform" />
        </ScrollViewer>


        <!--  拖入图片提醒  -->
        <Border x:Name="Border_DragOver"
                Grid.RowSpan="2"
                Grid.ColumnSpan="2"
                Margin="0,40,0,0"
                Padding="24"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Background="{ThemeResource ControlOnImageFillColorDefaultBrush}"
                CornerRadius="8"
                IsHitTestVisible="False"
                Opacity="0">
            <Border.OpacityTransition>
                <ScalarTransition />
            </Border.OpacityTransition>
            <StackPanel HorizontalAlignment="Center"
                        Orientation="Horizontal"
                        Spacing="12">
                <FontIcon FontSize="24"
                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                          Glyph="&#xE91B;" />
                <TextBlock VerticalAlignment="Center"
                           FontSize="16"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           Text="拖入图片" />
            </StackPanel>
        </Border>


        <!--  解码进度条  -->
        <ProgressBar Grid.RowSpan="2"
                     Grid.Column="1"
                     HorizontalAlignment="Stretch"
                     VerticalAlignment="Bottom"
                     IsIndeterminate="True"
                     Visibility="{x:Bind IsDecoding}" />


        <!--  查看器信息  -->
        <Grid x:Name="Grid_ButtomImageInfo"
              Grid.Row="1"
              Grid.Column="1"
              Height="44"
              ColumnSpacing="24"
              Visibility="Collapsed">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!--  左下角  -->
            <StackPanel Grid.Column="0"
                        Margin="6,0,0,0"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        Orientation="Horizontal"
                        Spacing="6">
                <!--  文件大小  -->
                <FontIcon Margin="12,0,4,0"
                          FontSize="16"
                          Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                          Glyph="&#xE74E;"
                          IsTextScaleFactorEnabled="False" />
                <TextBlock VerticalAlignment="Center"
                           Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                           IsTextScaleFactorEnabled="False"
                           Text="{x:Bind SelectedImageInfo.FileSize}" />
                <!--  像素大小  -->
                <FontIcon Margin="12,0,4,0"
                          FontSize="16"
                          Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                          Glyph="&#xE61F;"
                          IsTextScaleFactorEnabled="False" />
                <TextBlock VerticalAlignment="Center"
                           Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                           IsTextScaleFactorEnabled="False"
                           Text="{x:Bind SelectedImageInfo.PixelSize}" />
            </StackPanel>


            <!--  右下角  -->
            <StackPanel Grid.Column="1"
                        Margin="0,0,6,0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Orientation="Horizontal"
                        Spacing="6">
                <!--  适应页面  -->
                <Button x:Name="Button_ZoomToFitFactor"
                        Width="40"
                        Height="36"
                        Padding="0"
                        Click="Button_ZoomToFitFactor_Click"
                        Style="{ThemeResource DateTimePickerFlyoutButtonStyle}"
                        ToolTipService.ToolTip="适应窗口">
                    <FontIcon FontSize="16"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                              Glyph="&#xE9A6;"
                              IsTextScaleFactorEnabled="False" />
                </Button>
                <!--  缩放率  -->
                <TextBlock MinWidth="36"
                           VerticalAlignment="Center"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           HorizontalTextAlignment="Center"
                           IsTextScaleFactorEnabled="False"
                           Text="{x:Bind ScrollViewer_Image.ZoomFactor.ToString('P0', x:Null)}" />
                <!--  缩小  -->
                <Button x:Name="Button_ZoomOut"
                        Width="40"
                        Height="36"
                        Padding="0"
                        Click="Button_ZoomOut_Click"
                        Style="{ThemeResource DateTimePickerFlyoutButtonStyle}"
                        ToolTipService.ToolTip="缩小">
                    <FontIcon FontSize="16"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                              Glyph="&#xE71F;"
                              IsTextScaleFactorEnabled="False" />
                </Button>
                <!--  缩放滑块  -->
                <Slider x:Name="Slider_ZoomFactor"
                        Width="160"
                        VerticalAlignment="Center"
                        ManipulationDelta="Slider_ZoomFactor_ManipulationDelta"
                        ManipulationMode="TranslateX,System"
                        Maximum="5"
                        Minimum="0.1"
                        StepFrequency="0.01"
                        ThumbToolTipValueConverter="{StaticResource ZoomFactorPercentConverter}"
                        Value="{x:Bind ScrollViewer_Image.ZoomFactor}" />
                <!--  放大  -->
                <Button x:Name="Button_ZoomIn"
                        Width="40"
                        Height="36"
                        Padding="0"
                        Click="Button_ZoomIn_Click"
                        Style="{ThemeResource DateTimePickerFlyoutButtonStyle}"
                        ToolTipService.ToolTip="放大">
                    <FontIcon FontSize="16"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                              Glyph="&#xE8A3;"
                              IsTextScaleFactorEnabled="False" />
                </Button>
            </StackPanel>

        </Grid>


        <!--  错误提醒  -->
        <InfoBar x:Name="InfoBar"
                 Grid.RowSpan="2"
                 Grid.ColumnSpan="2"
                 MaxWidth="680"
                 Margin="240,0,240,80"
                 HorizontalAlignment="Stretch"
                 VerticalAlignment="Bottom"
                 IsOpen="False" />



    </Grid>



</Page>
